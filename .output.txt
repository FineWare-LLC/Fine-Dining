
> frontend@0.1.0 test
> node --test src/tests/unit/*test.js src/tests/unit/*test.mjs src/tests/solver/*test.js src/tests/gpu/*test.mjs
Benchmark 256x256 took 71.350833 ms
▶ GPU performance benchmark
  ✔ multiplies a large matrix within a reasonable time (72.212875ms)
✔ GPU performance benchmark (72.64925ms)
Encryption keys missing; phone numbers and addresses will not be encrypted.
Running optimization for 2 meals...
Running HiGHS 1.10.0 (git hash: fd8665394): Copyright (c) 2025 HiGHS under MIT licence terms
Model transferred to HiGHS – solving...
LP   has 4 rows; 2 cols; 8 nonzeros
Running optimization for 2 meals...
Coefficient ranges:
  Matrix [2e+00, 2e+02]
  Cost   [2e+00, 3e+00]
  Bound  [4e+00, 4e+00]
  RHS    [5e+00, 5e+02]
Running HiGHS 1.10.0 (git hash: fd8665394): Copyright (c) 2025 HiGHS under MIT licence terms
Model transferred to HiGHS – solving...
LP   has 4 rows; 2 cols; 8 nonzeros
Running optimization for 2 meals...
Coefficient ranges:
  Matrix [2e+00, 2e+02]
  Cost   [2e+00, 3e+00]
  Bound  [4e+00, 4e+00]
  RHS    [5e+00, 5e+02]
Running HiGHS 1.10.0 (git hash: fd8665394): Copyright (c) 2025 HiGHS under MIT licence terms
Model transferred to HiGHS – solving...
LP   has 4 rows; 2 cols; 8 nonzeros
Coefficient ranges:
  Matrix [2e+00, 2e+02]
  Cost   [2e+00, 3e+00]
  Bound  [4e+00, 4e+00]
  RHS    [5e+00, 5e+02]
Presolving model
Presolving model
Presolving model
4 rows, 2 cols, 8 nonzeros  0s
4 rows, 2 cols, 8 nonzeros  0s
4 rows, 2 cols, 8 nonzeros  0s
3 rows, 2 cols, 6 nonzeros  0s
3 rows, 2 cols, 6 nonzeros  0s
3 rows, 2 cols, 6 nonzeros  0s
3 rows, 2 cols, 6 nonzeros  0s
3 rows, 2 cols, 6 nonzeros  0s
Presolve : Reductions: rows 3(-1); columns 2(-0); elements 6(-2)
3 rows, 2 cols, 6 nonzeros  0s
Presolve : Reductions: rows 3(-1); columns 2(-0); elements 6(-2)
Presolve : Reductions: rows 3(-1); columns 2(-0); elements 6(-2)
Solving the presolved LP
Solving the presolved LP
Solving the presolved LP
Using EKK dual simplex solver - serial
Using EKK dual simplex solver - serial
Using EKK dual simplex solver - serial
  Iteration        Objective     Infeasibilities num(sum)
          0     0.0000000000e+00 Pr: 3(105) 0s
  Iteration        Objective     Infeasibilities num(sum)
          0     0.0000000000e+00 Pr: 3(105) 0s
  Iteration        Objective     Infeasibilities num(sum)
          0     0.0000000000e+00 Pr: 3(105) 0s
          2     3.0000000000e+00 Pr: 0(0) 0s
          2     3.0000000000e+00 Pr: 0(0) 0s
          2     3.0000000000e+00 Pr: 0(0) 0s
Solving the original LP from the solution after postsolve
Solving the original LP from the solution after postsolve
Solving the original LP from the solution after postsolve
Model status        : Optimal
Simplex   iterations: 2
Objective value     :  3.0000000000e+00
Relative P-D gap    :  0.0000000000e+00
HiGHS run time      :          0.03
Model status        : Optimal
Simplex   iterations: 2
Objective value     :  3.0000000000e+00
Relative P-D gap    :  0.0000000000e+00
HiGHS run time      :          0.03
Model status        : Optimal
Simplex   iterations: 2
Objective value     :  3.0000000000e+00
Relative P-D gap    :  0.0000000000e+00
HiGHS run time      :          0.03
Solver status code: 7
Solver status code: 7
Solver status code: 7
✔ runOptimization can be executed concurrently (43.679292ms)
Encryption keys missing; phone numbers and addresses will not be encrypted.
﹣ generateOptimizedMealPlan completes within benchmark (0.449666ms) # Skipping due to mock conflict - prepareSolverData already mocked
✔ countMeals delegates to MealModel.countDocuments (0.819208ms)
✔ findMeals delegates to MealModel.find (0.097666ms)
✔ findMealById delegates to MealModel.findById (0.078083ms)
Encryption keys missing; phone numbers and addresses will not be encrypted.
✔ findUserById delegates to User.findById (0.482459ms)
✔ getPlanIdFromQuery handles mealPlanId param (0.380875ms)
✔ getPlanIdFromQuery falls back to planId (0.054459ms)
✔ getPlanIdFromQuery returns null when not present (3.243541ms)
Error clearing coordinates cache: ReferenceError: sessionStorage is not defined
    at clearCoordinatesCache (file:///Users/tt/IdeaProjects/Fine-Dining/frontend/src/utils/geolocation.js:107:5)
    at TestContext.<anonymous> (file:///Users/tt/IdeaProjects/Fine-Dining/frontend/src/tests/unit/geolocation.integration.test.js:13:5)
    at TestHook.runInAsyncScope (node:async_hooks:214:14)
    at TestHook.run (node:internal/test_runner/test:1062:25)
    at TestHook.run (node:internal/test_runner/test:1377:18)
    at Suite.runHook (node:internal/test_runner/test:980:20)
    at Test.run (node:internal/test_runner/test:1037:27)
    at Test.start (node:internal/test_runner/test:959:17)
    at node:internal/test_runner/test:1464:71
    at node:internal/per_context/primordials:483:82
Error clearing coordinates cache: ReferenceError: sessionStorage is not defined
    at clearCoordinatesCache (file:///Users/tt/IdeaProjects/Fine-Dining/frontend/src/utils/geolocation.js:107:5)
    at TestContext.<anonymous> (file:///Users/tt/IdeaProjects/Fine-Dining/frontend/src/tests/unit/geolocation.integration.test.js:13:5)
    at TestHook.runInAsyncScope (node:async_hooks:214:14)
    at TestHook.run (node:internal/test_runner/test:1062:25)
    at TestHook.run (node:internal/test_runner/test:1377:18)
    at Suite.runHook (node:internal/test_runner/test:980:20)
    at Test.run (node:internal/test_runner/test:1037:27)
    at Suite.processPendingSubtests (node:internal/test_runner/test:752:18)
    at Test.postRun (node:internal/test_runner/test:1191:19)
    at Test.run (node:internal/test_runner/test:1119:12)
▶ Geolocation Integration Tests
  ✖ should return fallback coordinates when geolocation is not available (1.066167ms)
Error clearing coordinates cache: ReferenceError: sessionStorage is not defined
    at clearCoordinatesCache (file:///Users/tt/IdeaProjects/Fine-Dining/frontend/src/utils/geolocation.js:107:5)
    at TestContext.<anonymous> (file:///Users/tt/IdeaProjects/Fine-Dining/frontend/src/tests/unit/geolocation.integration.test.js:13:5)
    at TestHook.runInAsyncScope (node:async_hooks:214:14)
    at TestHook.run (node:internal/test_runner/test:1062:25)
    at TestHook.run (node:internal/test_runner/test:1377:18)
    at Suite.runHook (node:internal/test_runner/test:980:20)
    at Test.run (node:internal/test_runner/test:1037:27)
    at Suite.processPendingSubtests (node:internal/test_runner/test:752:18)
    at Test.postRun (node:internal/test_runner/test:1191:19)
    at Test.run (node:internal/test_runner/test:1119:12)
  ✔ should return geolocation coordinates when available (3.096542ms)
Error clearing coordinates cache: ReferenceError: sessionStorage is not defined
    at clearCoordinatesCache (file:///Users/tt/IdeaProjects/Fine-Dining/frontend/src/utils/geolocation.js:107:5)
    at TestContext.<anonymous> (file:///Users/tt/IdeaProjects/Fine-Dining/frontend/src/tests/unit/geolocation.integration.test.js:13:5)
    at TestHook.runInAsyncScope (node:async_hooks:214:14)
    at TestHook.run (node:internal/test_runner/test:1062:25)
    at TestHook.run (node:internal/test_runner/test:1377:18)
    at Suite.runHook (node:internal/test_runner/test:980:20)
    at Test.run (node:internal/test_runner/test:1037:27)
    at Suite.processPendingSubtests (node:internal/test_runner/test:752:18)
    at Test.postRun (node:internal/test_runner/test:1191:19)
    at Test.run (node:internal/test_runner/test:1119:12)
  ✔ should cache coordinates and return cached values on subsequent calls (1.99825ms)
Error clearing coordinates cache: ReferenceError: sessionStorage is not defined
    at clearCoordinatesCache (file:///Users/tt/IdeaProjects/Fine-Dining/frontend/src/utils/geolocation.js:107:5)
    at TestContext.<anonymous> (file:///Users/tt/IdeaProjects/Fine-Dining/frontend/src/tests/unit/geolocation.integration.test.js:13:5)
    at TestHook.runInAsyncScope (node:async_hooks:214:14)
    at TestHook.run (node:internal/test_runner/test:1062:25)
    at TestHook.run (node:internal/test_runner/test:1377:18)
    at Suite.runHook (node:internal/test_runner/test:980:20)
    at Test.run (node:internal/test_runner/test:1037:27)
    at Suite.processPendingSubtests (node:internal/test_runner/test:752:18)
    at Test.postRun (node:internal/test_runner/test:1191:19)
    at Test.run (node:internal/test_runner/test:1119:12)
  ✔ should force refresh coordinates when requested (5.158458ms)
Geolocation error — falling back to default coordinates: Geolocation permission denied
Error clearing coordinates cache: ReferenceError: sessionStorage is not defined
    at clearCoordinatesCache (file:///Users/tt/IdeaProjects/Fine-Dining/frontend/src/utils/geolocation.js:107:5)
    at TestContext.<anonymous> (file:///Users/tt/IdeaProjects/Fine-Dining/frontend/src/tests/unit/geolocation.integration.test.js:13:5)
    at TestHook.runInAsyncScope (node:async_hooks:214:14)
    at TestHook.run (node:internal/test_runner/test:1062:25)
    at TestHook.run (node:internal/test_runner/test:1377:18)
    at Suite.runHook (node:internal/test_runner/test:980:20)
    at Test.run (node:internal/test_runner/test:1037:27)
    at Suite.processPendingSubtests (node:internal/test_runner/test:752:18)
    at Test.postRun (node:internal/test_runner/test:1191:19)
    at Test.run (node:internal/test_runner/test:1119:12)
Error reading cached coordinates: Error: Storage quota exceeded
    at Object.getItem (file:///Users/tt/IdeaProjects/Fine-Dining/frontend/src/tests/unit/geolocation.integration.test.js:157:15)
    at getRestaurantSearchCoordinates (file:///Users/tt/IdeaProjects/Fine-Dining/frontend/src/utils/geolocation.js:73:43)
    at TestContext.<anonymous> (file:///Users/tt/IdeaProjects/Fine-Dining/frontend/src/tests/unit/geolocation.integration.test.js:184:31)
    at Test.runInAsyncScope (node:async_hooks:214:14)
    at Test.run (node:internal/test_runner/test:1062:25)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async Suite.processPendingSubtests (node:internal/test_runner/test:752:7)
  ✔ should handle geolocation errors gracefully (2.370833ms)
Error caching coordinates: Error: Storage quota exceeded
    at Object.setItem (file:///Users/tt/IdeaProjects/Fine-Dining/frontend/src/tests/unit/geolocation.integration.test.js:160:15)
    at getRestaurantSearchCoordinates (file:///Users/tt/IdeaProjects/Fine-Dining/frontend/src/utils/geolocation.js:92:20)
    at async TestContext.<anonymous> (file:///Users/tt/IdeaProjects/Fine-Dining/frontend/src/tests/unit/geolocation.integration.test.js:184:25)
    at async Test.run (node:internal/test_runner/test:1069:7)
    at async Suite.processPendingSubtests (node:internal/test_runner/test:752:7)
Error clearing coordinates cache: Error: Storage quota exceeded
    at Object.removeItem (file:///Users/tt/IdeaProjects/Fine-Dining/frontend/src/tests/unit/geolocation.integration.test.js:163:15)
    at clearCoordinatesCache (file:///Users/tt/IdeaProjects/Fine-Dining/frontend/src/utils/geolocation.js:107:20)
    at TestContext.<anonymous> (file:///Users/tt/IdeaProjects/Fine-Dining/frontend/src/tests/unit/geolocation.integration.test.js:32:5)
    at TestHook.runInAsyncScope (node:async_hooks:214:14)
    at TestHook.run (node:internal/test_runner/test:1062:25)
    at TestHook.run (node:internal/test_runner/test:1377:18)
    at Suite.runHook (node:internal/test_runner/test:980:20)
    at node:internal/test_runner/test:1025:27
    at node:internal/util:580:20
    at Test.run (node:internal/test_runner/test:1087:13)
  ✔ should handle sessionStorage errors gracefully (1.306041ms)
✖ Geolocation Integration Tests (15.81375ms)
file:///Users/tt/IdeaProjects/Fine-Dining/frontend/src/tests/unit/geolocation.test.js:33
global.navigator = { geolocation: mockGeolocation };
                 ^
TypeError: Cannot set property navigator of #<Object> which has only a getter
    at file:///Users/tt/IdeaProjects/Fine-Dining/frontend/src/tests/unit/geolocation.test.js:33:18
    at ModuleJob.run (node:internal/modules/esm/module_job:358:25)
    at async onImport.tracePromise.__proto__ (node:internal/modules/esm/loader:665:26)
    at async asyncRunEntryPointWithESMLoader (node:internal/modules/run_main:99:5)
Node.js v24.2.0
✖ src/tests/unit/geolocation.test.js (67.408959ms)
﹣ localRestaurants service exports missing functions (1.1195ms) # SKIP
✔ multiplyCPU correctly multiplies 2x2 matrices (0.684583ms)
﹣ benchmark completes using GPU when available (0.05575ms) # SKIP
✔ benchmark completes quickly on CPU (0.332167ms)
﹣ menuScraper has no parsable function (0.306375ms) # SKIP
Encryption keys missing; phone numbers and addresses will not be encrypted.
▶ OptimizationService
  ﹣ prepareSolverData returns formatted data for valid input (0.426917ms) # Skipping due to mock conflict - methods already mocked
  ﹣ generateOptimizedMealPlan throws when no meals exist (0.081708ms) # Skipping due to mock conflict - methods already mocked
  ﹣ runOptimization rejects on infeasible status (0.0815ms) # Solver not available or missing prototype
✔ OptimizationService (1.048375ms)
Google Places failed (Google fail). Falling back to Overpass.
✔ findNearbyRestaurants returns Google results with valid key (0.907959ms)
✔ findNearbyRestaurants falls back to Overpass when Google fails (0.454ms)
✔ registerPlugin stores setup and listPlugins returns names (12.320834ms)
✔ registerPlugin throws on duplicate names (3.665208ms)
✔ getPlugin returns undefined for unknown plugin (8.662667ms)
✔ applyPlugins invokes plugin callbacks and mutates solver (13.633542ms)
✔ createReview succeeds (0.776334ms)
✔ createReview handles failure (0.261625ms)
✔ getReviewsByTarget succeeds (0.212958ms)
✔ getReviewsByTarget handles failure (0.112375ms)
✔ sanitizeString escapes HTML tags (0.494084ms)
✔ sanitizeString leaves plain text intact (0.064542ms)
▶ Test Helpers Demo
  ✔ createMockUser creates valid user objects (0.660333ms)
  ✔ createMockMeal creates valid meal objects (0.106ms)
  ✔ createMockMeals creates multiple meals (0.115667ms)
  ✔ measureExecutionTime measures function performance (51.012625ms)
  ✔ safeMock handles mock conflicts gracefully (0.332208ms)
  ✔ validateObjectStructure validates object structures (0.245583ms)
  ✔ withTimeout handles async operations with timeout (61.498542ms)
  ✔ integration test using multiple helpers (11.703125ms)
✔ Test Helpers Demo (126.444667ms)
✔ queues toasts beyond limit (0.433125ms)
✔ removing toast pulls from queue (0.134625ms)
✔ optimistic and final toasts sync with latency (51.749792ms)
✔ generatePasswordResetToken sets fields and returns a token (0.52525ms)
✔ comparePassword delegates to bcrypt (0.243583ms)
✔ enableTwoFactor and disableTwoFactor update flags correctly (0.274041ms)
ℹ tests 51
ℹ suites 4
ℹ pass 42
ℹ fail 2
ℹ cancelled 0
ℹ skipped 7
ℹ todo 0
ℹ duration_ms 458.481667
✖ failing tests:
test at src/tests/unit/geolocation.integration.test.js:37:3
✖ should return fallback coordinates when geolocation is not available (1.066167ms)
  TypeError [Error]: Cannot set property navigator of #<Object> which has only a getter
      at TestContext.<anonymous> (file:///Users/tt/IdeaProjects/Fine-Dining/frontend/src/tests/unit/geolocation.integration.test.js:39:22)
      at Test.runInAsyncScope (node:async_hooks:214:14)
      at Test.run (node:internal/test_runner/test:1062:25)
      at async Promise.all (index 0)
      at async Suite.run (node:internal/test_runner/test:1466:7)
      at async startSubtestAfterBootstrap (node:internal/test_runner/harness:332:3)
test at src/tests/unit/geolocation.test.js:1:1
✖ src/tests/unit/geolocation.test.js (67.408959ms)
  'test failed'
